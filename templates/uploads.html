<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .upload-container {
            background: rgba(20, 20, 20, 0.85);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 600px;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.5s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .upload-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0) 50%,
                    rgba(255, 255, 255, 0.1) 100%);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .upload-header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
        }

        .upload-header h1 {
            color: #ffffff;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .upload-header p {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            position: relative;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .form-group label {
            font-weight: 600;
            color: #ffffff;
            font-size: 1.1rem;
        }

        .file-input-wrapper {
            position: relative;
            border: 3px dashed rgba(255, 255, 255, 0.2);
            padding: 3rem;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(30, 30, 30, 0.5);
            cursor: pointer;
            overflow: hidden;
        }

        .file-input-wrapper:hover {
            border-color: #667eea;
            background: rgba(40, 40, 40, 0.8);
            transform: translateY(-2px);
        }

        .file-input-wrapper.dragover {
            border-color: #667eea;
            background: rgba(40, 40, 40, 0.8);
            transform: scale(1.02);
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .file-input-text {
            color: #a0a0a0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .file-input-text p {
            font-size: 1rem;
        }

        .file-input-text .icon {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent);
            transition: 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #333333;
            color: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
            display: none;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .file-preview {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 10px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-icon {
            font-size: 2rem;
            color: #667eea;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: #ffffff;
        }

        .file-size {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .remove-file {
            color: #ff4444;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .remove-file:hover {
            transform: scale(1.1);
            color: #ff6666;
        }

        /* Update loader styles */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div x-data="setup()" x-init="$refs.loading.classList.add('hidden');">
        <div class="flex h-screen antialiased text-gray-900 bg-gray-100 dark:bg-dark dark:text-light">
            <!-- Loading screen -->
            <div x-ref="loading"
                class="fixed inset-0 z-50 flex items-center justify-center text-2xl font-semibold text-white bg-blue-600">
                Loading.....
            </div>

            <!-- Sidebar -->
            <div x-transition:enter="transform transition-transform duration-300"
                x-transition:enter-start="-translate-x-full" x-transition:enter-end="translate-x-0"
                x-transition:leave="transform transition-transform duration-300"
                x-transition:leave-start="translate-x-0" x-transition:leave-end="-translate-x-full"
                x-show="isSidebarOpen" class="fixed inset-y-0 z-10 flex w-80">
                <!-- Curvy shape -->
                <svg class="absolute inset-0 w-full h-full text-white"
                    style="filter: drop-shadow(10px 0 10px #00000030)" preserveAspectRatio="none" viewBox="0 0 309 800"
                    fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M268.487 0H0V800H247.32C207.957 725 207.975 492.294 268.487 367.647C329 243 314.906 53.4314 268.487 0Z" />
                </svg>
                <!-- Sidebar content -->
                <div class="z-10 flex flex-col flex-1">
                    <div class="flex items-center justify-between flex-shrink-0 w-64 p-4">
                        <!-- Logo -->
                        <!-- <a href="#">
                            <span class="sr-only">K-UI</span>
                            <svg aria-hidden="true" class="w-16 h-auto text-blue-600" viewBox="0 0 96 53"
                                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M7.69141 34.7031L13.9492 28.1992L32.0898 52H40.1758L18.4492 23.418L38.5938 0.8125H30.4375L7.69141 26.125V0.8125H0.941406V52H7.69141V34.7031ZM35.3008 26.9102H52.457V21.6016H35.3008V26.9102ZM89.1914 13V35.5117C89.1914 39.2148 88.1719 42.0859 86.1328 44.125C84.1172 46.1641 81.1992 47.1836 77.3789 47.1836C73.6055 47.1836 70.6992 46.1641 68.6602 44.125C66.6211 42.0625 65.6016 39.1797 65.6016 35.4766V0.8125H58.9219V35.6875C58.9688 40.9844 60.6562 45.1445 63.9844 48.168C67.3125 51.1914 71.7773 52.7031 77.3789 52.7031L79.1719 52.6328C84.3281 52.2578 88.4062 50.5352 91.4062 47.4648C94.4297 44.3945 95.9531 40.4453 95.9766 35.6172V13H89.1914ZM89 8H96V1H89V8Z" />
                            </svg>
                        </a> -->
                        <!-- Close btn -->
                        <button @click="isSidebarOpen = false" class="p-1 rounded-lg focus:outline-none focus:ring">
                            <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            <span class="sr-only">Close sidebar</span>
                        </button>
                    </div>
                    <nav class="flex flex-col flex-1 w-64 p-4 mt-4">
                        <a href="#" class="flex items-center space-x-2">
                            <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                            </svg>
                            <span>Home</span>
                        </a>
                    </nav>
                    <div class="flex-shrink-0 p-4">
                        <button class="flex items-center space-x-2">
                            <svg aria-hidden="true" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
            <main class="flex flex-col items-center justify-center flex-1">
                <!-- Page content -->
                <button @click="isSidebarOpen = true" class="fixed p-2 text-white bg-black rounded-lg top-5 left-5">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <span class="sr-only">Open menu</span>
                </button>
                <h1 class="sr-only">Home</h1>
                <!-- <a href="https://github.com/kamona-ui" target="_blank">
                    <span class="sr-only">Kamona ui</span>
                    <svg aria-hidden="true" class="w-20 h-auto text-blue-600" viewBox="0 0 96 53"
                        fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M7.69141 34.7031L13.9492 28.1992L32.0898 52H40.1758L18.4492 23.418L38.5938 0.8125H30.4375L7.69141 26.125V0.8125H0.941406V52H7.69141V34.7031ZM35.3008 26.9102H52.457V21.6016H35.3008V26.9102ZM89.1914 13V35.5117C89.1914 39.2148 88.1719 42.0859 86.1328 44.125C84.1172 46.1641 81.1992 47.1836 77.3789 47.1836C73.6055 47.1836 70.6992 46.1641 68.6602 44.125C66.6211 42.0625 65.6016 39.1797 65.6016 35.4766V0.8125H58.9219V35.6875C58.9688 40.9844 60.6562 45.1445 63.9844 48.168C67.3125 51.1914 71.7773 52.7031 77.3789 52.7031L79.1719 52.6328C84.3281 52.2578 88.4062 50.5352 91.4062 47.4648C94.4297 44.3945 95.9531 40.4453 95.9766 35.6172V13H89.1914ZM89 8H96V1H89V8Z" />
                    </svg>
                </a> -->
            </main>
        </div>
    </div>
    <div class="upload-container">
        <div class="upload-header">
            <h1>Upload Your Video</h1>
            <p>Drag & drop your video file or click to browse</p>
        </div>

        <form id="uploadForm" class="upload-form" method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}


            <div class="form-group">
                <label for="video_file">{{ form.video_file.label }}</label>
                <div class="file-input-wrapper">
                    <input type="file" id="video_file" name="video_file" accept="video/*" required>
                    <div class="file-input-text">
                        <div class="icon">üìÅ</div>
                        <p>Click to select or drag and drop</p>
                        <p>Supported formats: MP4, AVI, MOV</p>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill"></div>
                </div>
            </div>

            <div class="file-preview">
                <div class="file-info">
                    <div class="file-icon">üé•</div>
                    <div class="file-details">
                        <div class="file-name">No file selected</div>
                        <div class="file-size">0 MB</div>
                    </div>
                    <div class="remove-file">√ó</div>
                </div>
            </div>

            {{ form.submit(class="submit-btn") }}
        </form>
        <!-- Detected Object Section -->
        <div id="detectedObjects"
            class="mt-12 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-700 p-10 rounded-2xl shadow-2xl border border-gray-700 hidden">
            <h2 class="text-3xl font-extrabold mb-6 text-white text-center">Detected Objects</h2>

            <!-- Object List -->
            <div id="objectList" class="mb-6 text-gray-300 text-lg text-center space-y-3">
                <!-- Dynamically populated list of objects will go here -->
            </div>

            <!-- Target Object Input -->
            <div class="mb-6">
                <input type="text" id="targetObject" placeholder="Enter target object"
                    class="border-2 border-gray-600 bg-gray-800 p-4 w-full mb-4 rounded-lg text-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-violet-500 transition duration-300 text-center placeholder-gray-500">
            </div>

            <!-- Track Button -->
            <div class="text-center">
                <button id="trackButton"
                    class="bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 text-white px-8 py-4 rounded-xl transition duration-300 font-semibold shadow-lg hover:shadow-2xl">
                    Track Object
                </button>
            </div>
        </div>
    </div>
    <!-- Loader with enhanced styling -->
    <div id="loader"
        class="absolute inset-0 bg-black bg-opacity-80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="loader border-t-4 border-violet-500 rounded-full w-16 h-16 animate-spin"></div>
    </div>
    <script>
        // Function to show loader on a specific div
        function showLoader(targetDiv) {
            const loader = $('#loader');
            loader.appendTo(targetDiv); // Move loader to the target div
            loader.removeClass('hidden'); // Show loader
        }

        // Function to hide loader
        function hideLoader() {
            $('#loader').addClass('hidden'); // Hide loader
        }

        // Show loader while uploading video
        $('#uploadForm').on('submit', function (e) {
            e.preventDefault(); // Prevent default form submission
            showLoader('#uploadForm'); // Show loader on the upload form
            var formData = new FormData(this);
            $.ajax({
                url: '/upload', // Backend endpoint for video upload
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    hideLoader(); // Hide loader
                    $('#detectedObjects').show(); // Show detected objects section
                    $('#objectList').empty(); // Clear previous results
                    response.detected_objects.forEach(function (obj) {
                        $('#objectList').append('<p>' + obj + '</p>'); // Append detected objects
                    });
                },
                error: function () {
                    hideLoader(); // Hide loader
                    alert('An error occurred while uploading the video.');
                }
            });
        });

        // Show loader while tracking object
        $('#trackButton').on('click', function () {
            var targetObject = $('#targetObject').val();
            if (!targetObject) {
                alert('Please enter a target object to track.');
                return;
            }
            showLoader('#detectedObjects'); // Show loader on the detected objects section
            var videoPath = 'uploads/' + $('#uploadForm input[type="file"]').val().split('\\').pop(); // Get the video file name
            $.post('/track', { target_object: targetObject, video_path: videoPath }, function (response) {
                hideLoader(); // Hide loader
                alert(response.message);
            }).fail(function () {
                hideLoader(); // Hide loader
                alert('An error occurred while tracking the object.');
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/2.8.1/alpine.js"></script>
    <script>
        const setup = () => {
            return {
                isSidebarOpen: false,
            }
        }
    </script>
</body>

</html> 